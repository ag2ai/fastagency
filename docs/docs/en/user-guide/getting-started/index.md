---
# 0.5 - API
# 2 - Release
# 3 - Contributing
# 5 - Template Page
# 10 - Default
# hide:
#   - navigation

search:
  boost: 10
---

# Quick start

You can try out FastAgency to build and deploy your multi-agent application in less than one hour by following this guide. You will learn how to write you workflow, test and debug it and finally deploy it on cloud. The deployed application will have chat interface and be secured with SSO authentication and a whitelist of users alloped to access it.

You can use three different setups, depending on how scalable solution you need:

- **Mesop**: This setup uses [**Mesop**](https://google.github.io/mesop/){target="_blank"}
    to build a web application for interacting with our workflow. It supports
    a single-worker deployments only, limiting its scalability. However, it
    is the fastest way to build and test your application.

- **FastAPI + Mesop**: This is fairly scalable setup using [**FastAPI**](https://fastapi.tiangolo.com/){target="_blank"} to execute your workflows and [**Mesop**](https://google.github.io/mesop/){target="_blank"} for interactive web application. [**FastAPI**](https://fastapi.tiangolo.com/){target="_blank"} supports execution with multiple workers, with each workflow being executed in the context of a WebSocket connection. [**Mesop**](https://google.github.io/mesop/){target="_blank"} is still limited to a single worker, although there is much less load on it due to workflows being executed in the [**FastAPI**](https://fastapi.tiangolo.com/){target="_blank"} workers.

- **NATS + FastAPI + Mesop**: This is the most scalable setup using a distributed message broker
    [**NATS.io MQ**](https://nats.io/){target="_blank"}. Workflows are being executed with
    multiple workers that attach to the MQ waiting for initiate workflow messages. Such workers
    can be running on different machines or even different data centers/cloud providers.
    Message queues are highly scalable, but more difficult to integrate with end-clients.
    In order to make such integrations easier, we will connect our [**NATS**](https://nats.io/){target="_blank"}-based message queue with the [**FastAPI**](https://fastapi.tiangolo.com/){target="_blank"} application.


## Project setup

We **strongly recommend** using [**Cookiecutter**](../cookiecutter/index.md) for setting up the project. It creates the project folder structure, default workflow, automatically installs all the necessary requirements, and creates a [devcontainer](https://code.visualstudio.com/docs/devcontainers/containers){target="_blank"} that can be used with [Visual Studio Code](https://code.visualstudio.com/){target="_blank"} for development.

You could also use virtual environment managers such as [venv](https://docs.python.org/3/library/venv.html){target="_blank"}, and a Python package manager, such as [pip](https://en.wikipedia.org/wiki/Pip_(package_manager)).


{! docs/en/user-guide/cookiecutter/index.md[ln:6-226] !}

!!! info
    If you used a different `project_slug` than the default `my_fastagency_app` this will be reflected in the project module naming. Keep this in mind when running the commands further in this guide (in [Run Application](#run-application)), you will need to replace `my_fastagency_app` with your `project_slug` name.
-----

## Workflow Development

### Define the Workflow

You need to define the workflow that your application will use. This is where you specify how the agents interact and what they do. Here's a simple example of a workflow definition as it is generated by the cookie cutter under `my_fastagency_app/workflow.py`:

```python
{! docs_src/getting_started/mesop/my_fastagency_app/my_fastagency_app/workflow.py !}
```

This code snippet sets up a simple learning chat between a student and a teacher. It defines the agents and how they should interact and specify how the conversation should be summarized.

### Run and Debug the Workflow

To ensure that the workflow we have defined is working properly, we can test it locally using MesopUI. The code below can be found under `my_fastagency_app/local/main_mesop.py` and imports the defined workflow and sets up MesopUI:

```python
{! docs_src/getting_started/mesop/my_fastagency_app/my_fastagency_app/local/main_mesop.py !}
```

Run MesopUI locally with the following command:

=== "Linux/MacOS"
    !!! note "Terminal"
        ```console
        gunicorn my_fastagency_app.local.main_mesop:app
        ```

=== "Windows"
    !!! note "Terminal"
        ```console
        waitress-serve --listen=0.0.0.0:8000 my_fastagency_app.local.main_mesop:app
        ```

Open the MesopUI URL [http://localhost:8000](http://localhost:8000) in your browser. You can now use the graphical user interface to start, run, test and debug the autogen workflow manually.

![Initial message](./images/chat-init.png)

### Run Workflow Tests

We can also use pytest to test the autogen workflow automatically, instead of manually testing it using MesopUI by using the generated `pytest` test found under `tests/test_workflow.py`.

```python
{! docs_src/getting_started/mesop/my_fastagency_app/tests/test_workflow.py !}
```

Run the test with the following command:

```console
pytest -s
```

Running the test could take up to 30 seconds, depending on latency and throughput of OpenAI (or other LLM providers).

## Deployment files

Depending on the interface you choose when setting up the project with`cookiecutter`, appropriate deployment files will be generated under `my_fastagency_app/deployment` folder. We'll quickly explain what they contain and how to use them.

### Registering workflow with a UI or a provider

The workflow definition will be registered either directly with an UI object or a network provider that will propagate messages back and forth over a network protocol.

=== "Mesop"
    In the case of a simple Mesop application, will register the workflow directly with `MesopUI` object and run it in the same process.

    ```python

    {!> docs_src/getting_started/mesop/my_fastagency_app/my_fastagency_app/deployment/main.py !}

    ```

=== "FastAPI + Mesop"
    In the case of FastAPI application, we will create an `FastAPIAdapter` and then include a router to the `FastAPI` application.
    The adapter will have all REST and Websocket routes for communicating with a client.

    ```python
    {!> docs_src/getting_started/fastapi/my_fastagency_app/my_fastagency_app/deployment/main_1_fastapi.py !}
    ```

=== "NATS + FastAPI + Mesop"
    In the case of NATS.io application, we will create an `NatsAdapter` and then
    add it to a `FastAPI` application using the `lifespan` parameter. The adapter
    will have all REST and Websocket routes for communicating with a client.

    ```python
    {!> docs_src/getting_started/nats_n_fastapi/my_fastagency_app/my_fastagency_app/deployment/main_1_nats.py !}

    ```
    The `NatsAdapter` requires a running NATS server. The easiest way to start the NATS server is by using [Docker](https://www.docker.com/){target="_blank"}. FastAgency uses the [JetStream](https://docs.nats.io/nats-concepts/jetstream){target="_blank"} feature of NATS and also utilizes authentication.

    ```
    {!> docs_src/getting_started/nats_n_fastapi/my_fastagency_app/.devcontainer/nats_server.conf !}
    ```

    In the above NATS configuration, we define a user called `fastagency`, and its password is read from the environment variable `FASTAGENCY_NATS_PASSWORD`. We also enable JetStream in NATS and configure NATS to serve via the appropriate ports.

### Adapter Chaining

In case we used network adapters in the step above, we can chain additional network adapters or UI objects to it.

=== "Mesop"
    Not applicable for this setup as there are no adapters used.

=== "FastAPI + Mesop"

    There is an additional specification file for an application using `MesopUI`
    to connect to the `FastAPIAdapter`

    !!! note "main_2_mesop.py"
    ```python
    {!> docs_src/getting_started/fastapi/my_fastagency_app/my_fastagency_app/deployment/main_2_mesop.py !}
    ```

=== "NATS + FastAPI + Mesop"

    Above, we created NATS.io provider that will start brokers waiting to consume
    initiate workflow messages from the message broker. Now, we create FastAPI
    service interacting with NATS.io provider:

    !!! note "main_2_fastapi.py"
        ```python
        {!> docs_src/getting_started/nats_n_fastapi/my_fastagency_app/my_fastagency_app/deployment/main_2_fastapi.py !}
        ```

    Finally, we create Mesop app communicating with the FastAPI application:

    !!! note "main_3_mesop.py"
        ```python
        {!> docs_src/getting_started/nats_n_fastapi/my_fastagency_app/my_fastagency_app/deployment/main_3_mesop.py !}
        ```


## Run Application Locally

Once everything is set up, you can run your FastAgency application using the following command:

=== "Mesop"

    The preferred way to run the [**Mesop**](https://google.github.io/mesop/){target="_blank"} application is using a Python WSGI HTTP server like [**Gunicorn**](https://gunicorn.org/){target="_blank"} on Linux and Mac or [**Waitress**](https://docs.pylonsproject.org/projects/waitress/en/stable/){target="_blank"} on Windows.

    - In the root of your project run:
    !!! note "Terminal"
        ```console
        gunicorn my_fastagency_app.deployment.main:app
        ```

=== "FastAPI + Mesop"

    In this setup, we need to run **two** commands in **separate** terminal windows:

    - Start **FastAPI** application using uvicorn, in the root of your project run:
    !!! note "Terminal 1"
        ```
        uvicorn my_fastagency_app.deployment.main_1_fastapi:app --host 0.0.0.0 --port 8008 --reload
        ```

    - Start **Mesop** web interface using gunicorn, in the root of your project run:
    !!! note "Terminal 2"
        ```
        gunicorn my_fastagency_app.deployment.main_2_mesop:app -b 0.0.0.0:8888 --reload
        ```

=== "NATS + FastAPI + Mesop"

    The **NATS** docker container is started automatically by Cookiecutter for this setup. In this setup, we need to run **three** commands in **separate** terminal windows:

    - Start **FastAPI** application that provides a conversational workflow, in the root of your project run::
    !!! note "Terminal 1"
        ```
        uvicorn my_fastagency_app.deployment.main_1_nats:app --reload
        ```

    - Start **FastAPI** application integrated with a **NATS** messaging system, in the root of your project run::
    !!! note "Terminal 2"
        ```
        uvicorn my_fastagency_app.deployment.main_2_fastapi:app --host 0.0.0.0 --port 8008 --reload
        ```

    - Start **Mesop** web interface using gunicorn, in the root of your project run::
    !!! note "Terminal 3"
        ```
        gunicorn my_fastagency_app.deployment.main_3_mesop:app -b 0.0.0.0:8888 --reload
        ```


### Output

The outputs will vary based on the interface, here is the output of the last terminal starting UI:

=== "Mesop"
    ```console
    [2024-10-10 13:19:18 +0530] [23635] [INFO] Starting gunicorn 23.0.0
    [2024-10-10 13:19:18 +0530] [23635] [INFO] Listening at: http://127.0.0.1:8000 (23635)
    [2024-10-10 13:19:18 +0530] [23635] [INFO] Using worker: sync
    [2024-10-10 13:19:18 +0530] [23645] [INFO] Booting worker with pid: 23645
    ```

    ![Initial message](./images/chat-init.png)

=== "FastAPI + Mesop"
    ```console
    [2024-10-10 13:19:18 +0530] [23635] [INFO] Starting gunicorn 23.0.0
    [2024-10-10 13:19:18 +0530] [23635] [INFO] Listening at: http://127.0.0.1:8888 (23635)
    [2024-10-10 13:19:18 +0530] [23635] [INFO] Using worker: sync
    [2024-10-10 13:19:18 +0530] [23645] [INFO] Booting worker with pid: 23645
    ```

    ![Initial message](./images/chat-init.png)

=== "NATS + FastAPI + Mesop"

    ```console
    [2024-10-10 13:19:18 +0530] [23635] [INFO] Starting gunicorn 23.0.0
    [2024-10-10 13:19:18 +0530] [23635] [INFO] Listening at: http://127.0.0.1:8888 (23635)
    [2024-10-10 13:19:18 +0530] [23635] [INFO] Using worker: sync
    [2024-10-10 13:19:18 +0530] [23645] [INFO] Booting worker with pid: 23645
    ```

    ![Initial message](./images/chat-init.png)

## Deployment

### Building the Docker Image

If you created the project using Cookiecutter, then building the Docker image is as simple as running the provided script, as shown below:

```console
./scripts/build_docker.sh
```

### Running the Docker Image

Similarly, running the Docker container is as simple as running the provided script, as shown below:

```console
./scripts/run_docker.sh
```

### Deploying to Fly.io

If you created the project using Cookiecutter, there is a built-in script to deploy your workflow to [**Fly.io**](https://fly.io/). Run it as shown below:

```console
./scripts/deploy_to_fly_io.sh
```
